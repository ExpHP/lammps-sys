# `lammps-sys`

Builds and generates Rust bindings for the C interface of LAMMPS, the [*Large-scale Atomic/Molecular Massively Parallel Simulator.*](http://lammps.sandia.gov/)

## Usage

`lammps-sys` is not currently on crates.io.  You can depend on it with a git dependency:

<!-- Please remember to update ALL TOML examples, not just this one! -->
```toml
[dependencies.lammps-sys]
tag = "v0.3.0"
git = "https://github.com/ExpHP/lammps-sys"
```

## Docs

See LAMMPS' [`library.h`].  This is the file that bindings will be generated to.

If you just want to see the rust signatures for the bindings, you can also generate those yourself:

```
git clone https://github.com/ExpHP/lammps-sys
cd lammps-sys
cargo doc
chromium target/doc/lammps_sys/index.html
```

## Linking

As of version v0.4, *only static linking is supported.*

LAMMPS is automatically downloaded and built from source.  The default settings hopefully work out-of-the-box on most systems, though they might not be fast.

## Does it work?

For an easier time diagnosing building/linking issues, you can clone this repo and try running the `link-test` example.

```sh
$ git clone https://github.com/ExpHP/lammps-sys
$ cd lammps-sys
$ cargo run --example=link-test
LAMMPS (31 Mar 2017)
Total wall time: 0:00:00
```

Be sure to try this using the environment variables and `--features` that you plan to enable in your own project.

## Configuration

### Environment variables

The following environment variables are used by `lammps-sys` to control the build:

* **`RUST_LAMMPS_MAKEFILE`** - A path to a LAMMPS Makefile on your local filesystem which will be used as a template by this crate.  See the files in [`src/MAKE`](https://github.com/lammps/lammps/tree/master/src/MAKE) of the LAMMPS source for examples.  If unset or left blank, the prepackaged makefile at `MAKE/Makefile.serial` will be used.

### Cargo features

#### Preprocessor Flags

The following flags add functions to the C API, and can be enabled through features.

| Feature | Effect | Package docs |
| ------- | ------ | ----- |
| **`exceptions`** | `-DLAMMPS_EXCEPTIONS` | Makes Lammps report errors through new API functions. **Without this feature, LAMMPS will abort the process on error.** |
| `bigbig`  | `-DLAMMPS_BIGBIG` | Adds support for ridiculously large structures, and adds some related functions to the C bindings. |

**Bolded** features are enabled by default.

#### Packages

Lammps' packages are configured through cargo features, which cause `lammps-sys` to run the appropriate makefile target before building Lammps. Only a few packages are currently supported; I only added what I needed. PRs to add features for more packages are welcome.

| Feature | Effect | Package docs |
| ------- | ------ | ----- |
| `user-misc` | Runs `make yes-user-misc` | [USER-MISC package](http://lammps.sandia.gov/doc/Section_packages.html#user-misc-package) |
| `user-omp`  | Runs `make yes-user-omp` | [USER-OMP package](http://lammps.sandia.gov/doc/accelerate_omp.html) |

In theory, using cargo features to control packages allows a library that depends on `lammps-sys` to enable a few specific packages it requires without having to dictate the entire build. (Though in practice I rather doubt any library will ever depend on `lammps-sys`!)

## How-to

### Enabling OpenMP

TODO

### Using a specific/modified version of lammps

This is not currently supported by `lammps-sys` in any fashion.

Prior versions of `lammps-sys` used the dynamic linking model, which made this possible. However, it required a bunch of manual setup and ultimately there is no way to ensure that the bindings generated by bindgen accurately reflect the library they are linking against.

<!-- DO NOT UPDATE THIS VERSION NUMBER! -->
<!-- It should remain at 0.3.0, the last version with dynamic linking. -->
If that does not deter you, however, feel free to check it out: [`lammps-sys v0.3.0`](https://github.com/ExpHP/lammps-sys/tree/v0.3.0)

## [License](COPYING)

Like Lammps, `lammps-sys` is licensed under the (full) GNU GPL v3.0. Please see the file `COPYING` for more details.

## [Release notes](relnotes.md)

## Citations

S. Plimpton, **Fast Parallel Algorithms for Short-Range Molecular Dynamics**, J Comp Phys, 117, 1-19 (1995)
